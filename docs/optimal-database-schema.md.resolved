# E-Commerce Database Schema - Optimal Complete Version

> [!NOTE]
> **The Ultimate Schema** - Tá»•ng há»£p tá»‘t nháº¥t tá»« táº¥t cáº£ cÃ¡c phiÃªn báº£n (v1.0 â†’ v4.0)  
> **65 entities** | **23 enums** | Production + Enterprise + CMS Ready

---

## ðŸ“Š Executive Summary

**PhÃ¢n tÃ­ch**: Sau khi review táº¥t cáº£ 5 phiÃªn báº£n schema documentation vÃ  so sÃ¡nh vá»›i hiá»‡n tráº¡ng trong API, Ä‘Ã¢y lÃ  báº£n schema **toÃ n diá»‡n vÃ  tá»‘i Æ°u nháº¥t**.

### Version Comparison

| Version | Entities | Focus | Status |
|---------|----------|-------|--------|
| **Current API** | **11** | MVP Basic | âœ… Implemented |
| v1.0 (docs) | 24 | MVP E-commerce | ðŸ“‹ Documented |
| v2.0 (docs) | 34 | Enhanced E-commerce | ðŸ“‹ Documented |
| v3.0 (docs) | 52 | + CMS & Scheduling | ðŸ“‹ Documented |
| v3.5 (docs) | 60 | + Security/Loyalty/Email/Mobile | ðŸ“‹ Documented |
| **v4.0 (docs)** | **65** | **+ Forms/Landing/Settings/ActivityLog** | **ðŸ“‹ Documented** |
| **â­ Optimal** | **65** | **All Features Combined** | **ðŸŽ¯ This Document** |

### Gap Analysis

**Current Implementation**: 11/65 entities (17% chá»‰)
- âœ… User, Category, Product, Order, OrderItem
- âœ… MediaFolder, Media, Cart, CartItem, Review

**Missing**: 54 entities (83%)
- Core E-commerce enhancements: 23 entities
- CMS Content: 14 entities  
- Scheduling: 4 entities
- Security: 2 entities
- Loyalty: 2 entities
- Email: 2 entities
- Mobile: 2 entities
- CMS Advanced (v4.0): 5 entities

---

## ðŸ—‚ï¸ Complete Entity Catalog (65  Entities)

### Group 1: ðŸ” Authentication & User Management (4)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 1 | User | âœ… Basic | User accounts with GDPR, loyalty, security | ðŸ”´ Core |
| 2 | VerificationToken | âŒ | Email/phone/password verification | ðŸ”´ High |
| 3 | ShippingAddress | âŒ | Delivery addresses | ðŸ”´ High |
| 4 | Notification | âŒ | User notifications system | ðŸŸ¡ Medium |

### Group 2: ðŸ“¦ Product Catalog (9)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 5 | Category | âœ… Complete | Hierarchical categories | ðŸ”´ Core |
| 6 | Product | âœ… Basic | Product with SEO, variants | ðŸ”´ Core |
| 7 | ProductVariant | âŒ | Size, color variations | ðŸ”´ High |
| 8 | ProductAttribute | âŒ | Attribute definitions | ðŸŸ¡ Medium |
| 9 | ProductTranslation | âŒ | Multi-language support | ðŸŸ¢ Low |
| 10 | Review | âœ… Basic | Product reviews with moderation | ðŸ”´ Core |
| 11 | ReviewReport | âŒ | Review moderation system | ðŸŸ¡ Medium |
| 12 | InventoryTransaction | âŒ | Stock movement tracking | ðŸ”´ High |
| 13 | MediaTag | âŒ | Media organization (v2.0) | ðŸŸ¢ Low |

### Group 3: ðŸ›’ Shopping & Cart (5)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 14 | Cart | âœ… Complete | Shopping cart | ðŸ”´ Core |
| 15 | CartItem | âœ… Complete | Cart items with variants | ðŸ”´ Core |
| 16 | Wishlist | âŒ | Saved items for later | ðŸŸ¡ Medium |
| 17 | WishlistItem | âŒ | Wishlist entries | ðŸŸ¡ Medium |
| 18 | CartAbandonment | âŒ | Recovery tracking & emails | ðŸŸ¡ Medium |

### Group 4: ðŸ“¦ Orders & Fulfillment (10)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 19 | Order | âœ… Basic | Customer orders | ðŸ”´ Core |
| 20 | OrderItem | âœ… Complete | Order line items | ðŸ”´ Core |
| 21 | OrderHistory | âŒ | Status change tracking | ðŸ”´ Critical |
| 22 | OrderNote | âŒ | Internal & customer notes | ðŸ”´ High |
| 23 | Payment | âŒ | Payment records | ðŸ”´ Critical |
| 24 | PaymentEvent | âŒ | Webhook logs | ðŸŸ¡ Medium |
| 25 | Shipment | âŒ | Shipping tracking | ðŸ”´ High |
| 26 | Return | âŒ | Return requests | ðŸ”´ High |
| 27 | ReturnItem | âŒ | Return line items | ðŸ”´ High |
| 28 | Invoice | âŒ | Order invoices (v2.0) | ðŸŸ¡ Medium |

### Group 5: ðŸŽ« Promotions & Marketing (5)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 29 | Coupon | âŒ | Discount codes | ðŸ”´ High |
| 30 | CouponUsage | âŒ | Usage tracking per user | ðŸ”´ High |
| 31 | FlashSale | âŒ | Time-limited sales | ðŸŸ¡ Medium |
| 32 | Banner | âŒ | Promotional banners | ðŸŸ¡ Medium |
| 33 | Popup | âŒ | Popup campaigns (v3.0) | ðŸŸ¡ Medium |

### Group 6: ðŸ’¬ Customer Support (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 34 | Ticket | âŒ | Support tickets | ðŸŸ¡ Medium |
| 35 | TicketMessage | âŒ | Ticket conversations | ðŸŸ¡ Medium |

### Group 7: ðŸ“Š Analytics & Tracking (3)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 36 | ProductView | âŒ | Product view tracking | ðŸŸ¢ Low |
| 37 | SearchLog | âŒ | Search query analytics | ðŸŸ¢ Low |
| 38 | CheckoutStep | âŒ | Funnel conversion tracking | ðŸŸ¢ Low |

### Group 8: ðŸ“ Media Management (3)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 39 | MediaFolder | âœ… Complete | Hierarchical folder structure | ðŸ”´ Core |
| 40 | Media | âœ… Basic | Uploaded files with metadata | ðŸ”´ Core |
| 41 | MediaTag | âŒ | Media tagging system | ðŸŸ¢ Low |

### Group 9: ðŸ“ CMS - Content (7)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 42 | BlogPost | âŒ | Blog posts with scheduling | ðŸ”´ High |
| 43 | BlogCategory | âŒ | Blog categories | ðŸ”´ High |
| 44 | BlogTag | âŒ | Blog tagging (v3.0) | ðŸŸ¡ Medium |
| 45 | BlogComment | âŒ | Comment system (v3.0) | ðŸŸ¡ Medium |
| 46 | Page | âŒ | Static pages | ðŸ”´ High |
| 47 | Menu | âŒ | Navigation menus | ðŸ”´ High |
| 48 | MenuItem | âŒ | Menu structure | ðŸ”´ High |

### Group 10: ðŸŽ¨ CMS - Marketing (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 49 | PopupSubmission | âŒ | Lead collection (v3.0) | ðŸŸ¡ Medium |
| 50 | HomeSection | âŒ | Homepage builder (v3.0) | ðŸŸ¡ Medium |

### Group 11: ðŸ” CMS - SEO (3)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 51 | SEO | âŒ | SEO meta management (v3.0) | ðŸ”´ High |
| 52 | SEORedirect | âŒ | URL redirects 301/302 | ðŸŸ¡ Medium |
| 53 | SitemapEntry | âŒ | Auto-generated sitemap | ðŸŸ¢ Low |

### Group 12: âš™ï¸ CMS - System (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 54 | ThemeSettings | âŒ | Theme configuration (v3.0) | ðŸŸ¡ Medium |
| 55 | Redirect | âŒ | General redirects (v2.0) | ðŸŸ¡ Medium |

### Group 13: â° Scheduling System (4)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 56 | ScheduledContent | âŒ | Content scheduling (v4.0) | ðŸŸ¡ Medium |
| 57 | ScheduledEmail | âŒ | Email scheduling (v4.0) | ðŸŸ¡ Medium |
| 58 | CronJob | âŒ | Automated tasks (v4.0) | ðŸŸ¡ Medium |
| 59 | Webhook | âŒ | Integration events (v4.0) | ðŸŸ¡ Medium |

### Group 14: ðŸ” Security & Audit (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 60 | LoginHistory | âŒ | Login tracking (v3.5) | ðŸ”´ Critical |
| 61 | SecurityEvent | âŒ | Security monitoring (v3.5) | ðŸ”´ Critical |

### Group 15: ðŸŽ Loyalty Program (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 62 | LoyaltyTransaction | âŒ | Points tracking (v3.5) | ðŸŸ¡ High |
| 63 | Reward | âŒ | Reward catalog (v4.0) | ðŸŸ¢ Low |

### Group 16: ðŸ“§ Email System (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 64 | EmailTemplate | âŒ | Email templates (v3.5) | ðŸ”´ High |
| 65 | EmailLog | âŒ | Email tracking (v3.5) | ðŸŸ¡ Medium |

### Group 17: ðŸ“± Mobile Support (2)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 66 | PushNotification | âŒ | Push alerts (v4.0) | ðŸŸ¡ Medium |
| 67 | AppVersion | âŒ | Version control (v3.5) | ðŸŸ¡ Medium |

### Group 18: ðŸŽ¨ CMS Advanced - v4.0 â­ (5)

| # | Entity | Current | Description | Priority |
|---|--------|---------|-------------|----------|
| 68 | **Form** | âŒ | Dynamic form builder | ðŸ”´ Critical |
| 69 | **FormSubmission** | âŒ | Form responses | ðŸ”´ Critical |
| 70 | **LandingPage** | âŒ | Landing page builder + A/B test | ðŸ”´ Critical |
| 71 | **Setting** | âŒ | Global configuration | ðŸ”´ Critical |
| 72 | **ActivityLog** | âŒ | CMS audit trail | ðŸ”´ Critical |

---

## ðŸ“‹ Complete Enums (23)

### Core E-commerce (11)

1. **Role**: `USER`, `SUPERADMIN`
2. **OrderStatus**: `PENDING`, `CONFIRMED`, `PROCESSING`, `SHIPPED`, `DELIVERED`, `COMPLETED`, `CANCELLED`, `REFUNDED`
3. **PaymentStatus**: `PENDING`, `AUTHORIZED`, `CAPTURED`, `FAILED`, `REFUNDED`, `PARTIALLY_REFUNDED`
4. **PaymentMethod**: `COD`, `BANK_TRANSFER`, `MOMO`, `VNPAY`, `STRIPE`, `PAYPAL`
5. **ShipmentStatus**: `PENDING`, `PICKED_UP`, `IN_TRANSIT`, `OUT_FOR_DELIVERY`, `DELIVERED`, `FAILED`, `RETURNED`
6. **DiscountType**: `PERCENTAGE`, `FIXED_AMOUNT`, `FREE_SHIPPING`
7. **InventoryTransactionType**: `PURCHASE`, `SALE`, `RETURN`, `ADJUSTMENT`, `DAMAGE`
8. **TokenType**: `EMAIL_VERIFICATION`, `PASSWORD_RESET`, `PHONE_VERIFICATION`
9. **NotificationType**: `ORDER_CONFIRMED`, `ORDER_SHIPPED`, `ORDER_DELIVERED`, `PAYMENT_SUCCESS`, etc.
10. **TicketStatus**: `OPEN`, `IN_PROGRESS`, `WAITING_CUSTOMER`, `RESOLVED`, `CLOSED`
11. **Priority**: `LOW`, `NORMAL`, `HIGH`, `URGENT`

### Enhanced Features (4)

12. **ReviewStatus**: `PENDING`, `APPROVED`, `REJECTED`, `FLAGGED`
13. **ReturnReason**: `DAMAGED`, `WRONG_ITEM`, `NOT_AS_DESCRIBED`, `CHANGED_MIND`, `DEFECTIVE`, `OTHER`
14. **ReturnStatus**: `REQUESTED`, `APPROVED`, `REJECTED`, `SHIPPED_BACK`, `RECEIVED`, `REFUNDED`, `COMPLETED`
15. **AttributeType**: `SELECT`, `MULTISELECT`, `TEXT`, `NUMBER`, `COLOR`

### CMS & Content (3)

16. **PostStatus**: `DRAFT`, `PUBLISHED`, `SCHEDULED`, `ARCHIVED`
17. **CommentStatus**: `PENDING`, `APPROVED`, `REJECTED`, `SPAM`
18. **PageStatus**: `DRAFT`, `PUBLISHED`, `ARCHIVED`

### Security & System (5)

19. **LoginStatus**: `SUCCESS`, `FAILED`, `BLOCKED`, `SUSPICIOUS` (v3.5)
20. **SecurityEventType**: `BRUTE_FORCE_ATTEMPT`, `SUSPICIOUS_LOGIN`, `PASSWORD_CHANGED`, etc. (v3.5)
21. **Severity**: `LOW`, `MEDIUM`, `HIGH`, `CRITICAL` (v3.5)
22. **EmailStatus**: `QUEUED`, `SENT`, `DELIVERED`, `OPENED`, `CLICKED`, `BOUNCED`, `FAILED` (v3.5)
23. **Platform**: `IOS`, `ANDROID`, `WEB`, `HUAWEI` (v3.5)

### v4.0 CMS (Included in above categories)

- **FormType**: `CONTACT`, `SURVEY`, `NEWSLETTER`, `EVENT_REGISTRATION`, etc.
- **FieldType**: `TEXT`, `EMAIL`, `PHONE`, `TEXTAREA`, etc.
- **FormTheme**: `DEFAULT`, `INLINE`, `POPUP`, `FULLPAGE`
- **SectionType**: `HERO`, `FEATURES`, `TESTIMONIALS`, `PRICING`, etc.
- **ConversionGoal**: `FORM_SUBMISSION`, `SIGNUP`, `PURCHASE`, etc.
- **SettingType**: `STRING`, `NUMBER`, `BOOLEAN`, `JSON`, etc.
- **SettingGroup**: `GENERAL`, `SEO`, `SOCIAL_MEDIA`, `EMAIL`, etc.
- **CMSAction**: `CREATED`, `UPDATED`, `DELETED`, `PUBLISHED`, etc.
- **EntityType**: `BLOG_POST`, `PAGE`, `PRODUCT`, `CATEGORY`, etc.

---

## ðŸŽ¯ Priority Classification

### P0 - Critical (Must Have) - 20 entities ðŸ”´

**E-commerce Core**
1. User (enhance existing)
2. VerificationToken
3. ShippingAddress
4. Product (enhance existing)
5. ProductVariant
6. InventoryTransaction
7. Order (enhance existing)
8. OrderHistory
9. OrderNote
10. Payment
11. Shipment
12. Coupon
13. CouponUsage

**CMS Essentials**
14. BlogPost
15. BlogCategory
16. Page
17. Menu
18. MenuItem
19. SEO

**Security**
20. LoginHistory
21. SecurityEvent

**v4.0 Critical**
22. Form â­
23. FormSubmission â­
24. LandingPage â­
25. Setting â­
26. ActivityLog â­

### P1 - High (Should Have) - 18 entities ðŸŸ¡

**E-commerce Enhanced**
1. Return
2. ReturnItem
3. Wishlist
4. WishlistItem
5. ReviewReport
6. FlashSale
7. Banner
8. notification

**CMS Extended**
9. BlogComment
10. EmailTemplate
11. EmailLog
12. Popup
13. PopupSubmission

**Loyalty**
14. LoyaltyTransaction

**Mobile**
15. AppVersion

### P2 - Medium (Nice to Have) - 15 entities ðŸŸ¢

**Marketing & Analytics**
1. CartAbandonment
2. ProductView
3. HomeSection
4. SearchLog
5. CheckoutStep

**CMS Advanced**
6. BlogTag
7. ThemeSettings
8. SEORedirect
9. Redirect

**Scheduling**
10. ScheduledContent
11. ScheduledEmail
12. CronJob
13. Webhook

**Mobile & Others**
14. PushNotification
15. PaymentEvent

### P3 - Low (Future) - 7 entities ðŸ”µ

1. ProductTranslation
2. ProductAttribute
3. MediaTag
4. Ticket
5. TicketMessage
6. SitemapEntry
7. Reward

---

## ðŸ”§ Implementation Differences vs Current

### Currently Implemented (11 models)

| Model | Status | Issues to Fix |
|-------|--------|---------------|
| User | âœ… Basic | Missing: profile fields, loyalty, security tracking |
| Category | âœ… Complete | Good - has hierarchy support |
| Product | âœ… Basic | Missing: variants, SKU, tags, isFeatured, averageRating |
| Order | âœ… Basic | Missing: detailed status tracking, coupon support |
| OrderItem | âœ… Complete | Good |
| MediaFolder | âœ… Complete | Good - has hierarchy |
| Media | âœ… Basic | Missing: tags, alt text, metadata |
| Cart | âœ… Complete | Good |
| CartItem | âœ… Complete | Good |
| Review | âœ… Basic | Missing: status, moderation, isVerified |

### Key Enhancements Needed

```diff
User model enhancements:
+ firstName, lastName, phone
+ avatar, dateOfBirth
+ loyaltyPoints, loyaltyTierId, totalPointsEarned
+ lastLoginAt, lastLoginIp 
+ failedLoginAttempts, lockedUntil
+ emailVerified, emailOptIn, pushOptIn
+ marketingConsent, dataProcessingConsent
+ preferredLanguage, preferredCurrency

Product model enhancements:
+ slug (unique)
+ brand, sku (unique), tags[]
+ isActive, isFeatured
+ averageRating, reviewCount (cached)
+ stock, reserved (inventory tracking)
+ seoTitle, seoDescription, seoKeywords[], ogImage

Order model enhancements:
+ subtotal, discountAmount, shippingFee, tax
+ shippingAddressId (FK), couponId (FK)
+ paymentMethod (enum)
+ Structured shippingAddress object (not string)

Review model enhancements:
+ verified (purchase verified)
+ images[] (review photos)
+ reportCount, isModerated
+ status (ReviewStatus enum)
+ helpfulCount, unhelpfulCount
```

---

## ðŸš€ Optimal Implementation Roadmap

Based on analysis of all versions, here's the recommended phased approach:

### **Phase 0: Foundation** (Week 1) ðŸ”§

**Goal**: Fix current issues and prepare infrastructure

- [ ] Enhance existing User model (security, preferences)
- [ ] Enhance existing Product model (SEO, features)
- [ ] Enhance existing Order model (structured address)
- [ ] Enhance existing Review model (moderation)
- [ ] Enhance existing Media model (metadata)
- [ ] Setup migration framework
- [ ] Create test environments
- [ ] Document API changes

**Deliverables**: Fixed base models, migration strategy

---

### **Phase 1: Critical E-commerce** (Weeks 2-5) ðŸ”´

#### Sprint 1.1: Product System (Week 2)
- [ ] ProductVariant - Enable product differentiation variations
- [ ] InventoryTransaction - Stock tracking
- [ ] Enhance Product with variants support
- [ ] API endpoints for variants
- [ ] Tests

#### Sprint 1.2: Order & Payment (Week 3)
- [ ] OrderHistory - Critical for tracking
- [ ] OrderNote - Internal communication
- [ ] Payment - Payment records
- [ ] Shipment - Shipping tracking
- [ ] Update Order model

#### Sprint 1.3: Returns & Promotions (Week 4)
- [ ] Return + ReturnItem - Return management
- [ ] Coupon - Discount codes
- [ ] CouponUsage - Usage tracking
- [ ] Discount calculation logic

#### Sprint 1.4: User Management (Week 5)
- [ ] VerificationToken - Email/phone verification
- [ ] ShippingAddress - Delivery addresses
- [ ] Notification - User notifications
- [ ] User profile completion

**Verification**:
```bash
npm run test -- products.service.spec.ts
npm run test -- orders.service.spec.ts
npm run test -- payment.service.spec.ts
npm run build
npm run lint
```

---

### **Phase 2: CMS Essentials** (Weeks 6-8) ðŸ”´

#### Sprint 2.1: Blog System (Week 6)
- [ ] BlogPost - Content marketing
- [ ] BlogCategory - Organization
- [ ] BlogComment - Engagement
- [ ] Blog API endpoints
- [ ] CMS UI for blog

#### Sprint 2.2: Pages & Navigation (Week 7)
- [ ] Page - Static pages
- [ ] Menu + MenuItem - Navigation
- [ ] SEO - Meta management
- [ ] Page builder basics

#### Sprint 2.3: v4.0 Critical Features (Week 8) â­
- [ ] Setting - Global configuration
- [ ] Form + FormSubmission - Form builder
- [ ] Form email notifications
- [ ] Settings API

**Verification**:
```bash
npm run test -- blog.service.spec.ts
npm run test -- pages.service.spec.ts
npm run test -- settings.service.spec.ts
# Manual: Create blog post, create form
```

---

### **Phase 3: Security & Audit** (Week 9) ðŸ”´

#### Sprint 3.1: Security Implementation
- [ ] LoginHistory - Login tracking
- [ ] SecurityEvent - Security monitoring
- [ ] Brute force protection
- [ ] Security dashboard
- [ ] ActivityLog - CMS audit trail

**Verification**:
```bash
npm run test -- security.service.spec.ts
npm run test -- activity-log.service.spec.ts
# Manual: Test login attempts, view activity logs
```

---

### **Phase 4: Enhanced Features** (Weeks 10-12) ðŸŸ¡

#### Sprint 4.1: Customer Features (Week 10)
- [ ] Wishlist + WishlistItem
- [ ] ReviewReport - Moderation
- [ ] Banner - Marketing
- [ ] Popup + PopupSubmission

#### Sprint 4.2: Email System (Week 11)
- [ ] EmailTemplate - Email design
- [ ] EmailLog - Delivery tracking
- [ ] Email service integration
- [ ] Transactional emails

#### Sprint 4.3: Loyalty Program (Week 12)
- [ ] LoyaltyTransaction - Points system
- [ ] Points earning rules
- [ ] Points redemption
- [ ] Loyalty dashboard

**Verification**:
```bash
npm run test -- wishlist.service.spec.ts
npm run test -- email.service.spec.ts
npm run test -- loyalty.service.spec.ts
```

---

### **Phase 5: CMS Advanced - v4.0** (Weeks 13-14) â­

#### Sprint 5.1: Landing Page Builder (Week 13)
- [ ] LandingPage - Page builder
- [ ] Section components library
- [ ] Drag & drop builder UI
- [ ] A/B testing logic
- [ ] Analytics integration

#### Sprint 5.2: Polish & Integration (Week 14)
- [ ] Integration testing
- [ ] Performance optimization
- [ ] Documentation updates
- [ ] Training materials

**Verification**:
```bash
npm run test -- landing-page.service.spec.ts
# Manual: Build landing page, test A/B variants
```

---

###**Phase 6: Marketing & Analytics** (Weeks 15-16) ðŸŸ¢

#### Sprint 6.1: Analytics
- [ ] ProductView - Tracking
- [ ] SearchLog - Search analytics
- [ ] CheckoutStep - Funnel optimization
- [ ] CartAbandonment - Recovery

#### Sprint 6.2: Content Scheduling
- [ ] ScheduledContent
- [ ] ScheduledEmail
- [ ] CronJob
- [ ] Webhook

**Verification**:
```bash
npm run test -- analytics.service.spec.ts
npm run test -- scheduler.service.spec.ts
```

---

### **Phase 7: Mobile & Remaining** (Weeks 17-18) ðŸŸ¢

#### Sprint 7.1: Mobile Support
- [ ] AppVersion - Version control
- [ ] PushNotification - Push system
- [ ] Mobile API optimization

#### Sprint 7.2: Final Features
- [ ] FlashSale
- [ ] ThemeSettings
- [ ] SEORedirect, SitemapEntry
- [ ] Remaining P3 entities
- [ ] Full regression testing

**Verification**:
```bash
npm run test  # Full test suite
npm run test:e2e
npm run lint
npm run build
# Manual: Complete feature walkthrough
```

---

## ðŸ“Š Feature Comparison Matrix

| Feature | Current API | v2.0 | v3.0 | v3.5 | v4.0 | Optimal |
|---------|-------------|------|------|------|------|---------|
| **Entities** | 11 | 34 | 52 | 60 | 65 | **65** |
| **Enums** | 2 | 15 | 18 | 22 | 23 | **23** |
| **User Management** | âœ… Basic | âœ… Enhanced | âœ… | âœ… Security | âœ… | âœ… Complete |
| **Product Variants** | âŒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Order Tracking** | âŒ | âœ… History | âœ… | âœ… | âœ… | âœ… |
| **Returns** | âŒ | âœ… | âœ… | âœ… | âœ… | âœ… |
| **CMS** | âŒ | âŒ | âœ… Full | âœ… | âœ… | âœ… Complete |
| **Blog System** | âŒ | âŒ | âœ… | âœ… | âœ… | âœ… |
| **SEO** | âŒ | Basic | âœ… Advanced | âœ… | âœ… | âœ… Complete |
| **Security** | âŒ | âŒ | âŒ | âœ… Full | âœ… | âœ… Enterprise |
| **Loyalty** | âŒ | âŒ | âŒ | âœ… | âœ… | âœ… |
| **Email Automation** | âŒ | âŒ | âŒ | âœ… | âœ… | âœ… |
| **Mobile Support** | âŒ | âŒ | âŒ | âœ… | âœ… | âœ… |
| **Form Builder** | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Landing Pages** | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Settings System** | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Activity Log** | âŒ | âŒ | âŒ | âŒ | âœ… | âœ… |
| **Scheduling** | âŒ | âŒ | âœ… | âœ… | âœ… | âœ… |

**Legend**: âŒ Missing | âœ… Implemented/Documented

---

## ðŸŽ¯ Success Metrics

### Technical Metrics

- 100% P0 entities implemented
- 90%+ P1 entities implemented
- Test coverage > 80%
- API response time < 200ms
- Zero critical bugs
- Build passes with strict lint

### Business Metrics

| Feature | Metric | Target |
|---------|--------|--------|
| Forms | Submission rate | >15% |
| Landing Pages | Conversion rate | >5% |
| Email | Open rate | >25% |
| Email | Click rate | >3% |
| Loyalty | Repeat purchase | +30% |
| Security | Blocked attacks | >99% |
| Blog | Monthly posts | >10 |
| SEO | Organic traffic | +50% |

---

## âš ï¸ Critical Decisions & Trade-offs

### 1. Which version to follow?

**Decision**: v4.0 as base, cherry-pick best from all versions

**Rationale**:
- v4.0 has the most comprehensive feature set (65 entities)
- Includes critical v4.0 features (Forms, Landing Pages, Settings)
- Maintains all improvements from v2.0, v3.0, v3.5
- Proven patterns and best practices from each version

### 2. Database: MongoDB vs PostgreSQL?

**Current**: MongoDB (in use)  
**Recommendation**: Keep MongoDB

**Rationale**:
- Already using Prisma with MongoDB
- Flexible schema for CMS content
- Good for rapid iteration
- Handles JSON fields well (FormSubmission data, settings values)

### 3. Migration strategy?

**Recommendation**: Phased migration (18 weeks)

**Rationale**:
- Lower risk than big bang
- Continuous delivery of value
- Easier rollback
- Team can learn incrementally

### 4. Breaking changes?

**Identified Breaking Changes**:
1. Order.shippingAddress: string â†’ structured object
2. Product: Adding variants changes API response
3. User: New required fields (migration needed)
4. API versioning required for backwards compatibility

**Mitigation**: Use API versioning (`/api/v1`, `/api/v2`)

---

## ðŸ“š References to Source Documents

- **v2.0**: [database-schema.md](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/docs/database-schema.md) - 34 entities, enhanced e-commerce
- **v2.0 Quick**: [database-schema-simple.md](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/docs/database-schema-simple.md) - Quick reference
- **v3.0**: [database-schema-v3-final.md](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/docs/database-schema-v3-final.md) - 52 entities, + CMS & Scheduling
- **v3.5**: [database-schema-v3.5-final.md](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/docs/database-schema-v3.5-final.md) - 60 entities, + Security/Loyalty/Email/Mobile
- **v4.0**: [database-schema-v4-final.md](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/docs/database-schema-v4-final.md) - 65 entities, + Forms/Landing/Settings/ActivityLog
- **Current**: [schema.prisma](file:///home/huu/.gemini/antigravity/scratch/ecommerce-platform/apps/api/prisma/schema.prisma) - 11 models implemented

---

## ðŸŽ“ Key Learnings from All Versions

### From v2.0
âœ… OrderHistory and OrderNote are **critical** for production  
âœ… CouponUsage tracking prevents abuse  
âœ… Returns/Refunds system is essential  
âœ… Review moderation prevents spam

### From v3.0
âœ… Blog system drives SEO and content marketing  
âœ… Scheduling system enables automation  
âœ… Page builder empowers marketing team  
âœ… SEO redirects improve site health

### From v3.5
âœ… Security monitoring is **mandatory** for enterprise  
âœ… Loyalty program significantly boosts retention  
âœ… Email automation improves engagement  
âœ… Mobile version control prevents support issues

### From v4.0
âœ… Form builder is **critical** for lead generation  
âœ… Landing pages enable marketing campaigns  
âœ… Centralized settings reduce hardcoding  
âœ… Activity logging improves security **and** compliance

---

> [!IMPORTANT]
> **This is the definitive database schema** - Káº¿t há»£p tá»‘t nháº¥t tá»« táº¥t cáº£ cÃ¡c versions (v1.0 â†’ v4.0). Follow roadmap tá»« Phase 0 â†’ Phase 7 Ä‘á»ƒ implement Ä‘áº§y Ä‘á»§.

> [!TIP]
> **Quick Win**: Implement Phase 0-1 first (Weeks 1-5) Ä‘á»ƒ cÃ³ core e-commerce production-ready. CMS cÃ³ thá»ƒ add sau.

> [!WARNING]
> **Breaking Changes**: Order.shippingAddress vÃ  Product variants sáº½ require API v2. Plan API versioning strategy trÆ°á»›c khi báº¯t Ä‘áº§u.

---

**Document Version**: 1.0 - Optimal  
**Created**: 2025-12-18  
**Based on**: v1.0, v2.0, v3.0, v3.5, v4.0 documentation  
**Status**: âœ… Ready for review and implementation
